
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é™æµæŠ€æœ¯è¯¦è§£ä¸å®è·µ | åŒ—è¾°</title>
  <link rel="stylesheet" href="../../../../css/common.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  <style>
    .post-content {
      max-width: 800px;
      margin: 0 auto;
      line-height: 1.8;
    }
    .post-header {
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }
    .post-header h1 {
      font-size: 2.2rem;
      margin-bottom: 1rem;
      color: var(--primary);
    }
    .post-meta {
      color: #888;
      font-size: 0.95rem;
      margin-bottom: 1rem;
    }
    .post-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
      margin-bottom: 1rem;
    }
    .post-tag {
      background: rgba(67, 97, 238, 0.1);
      color: var(--primary);
      padding: 0.5rem 1rem;
      border-radius: 15px;
      font-size: 0.9rem;
      font-weight: 600;
    }
    .post-tag.category {
      background: rgba(72, 187, 120, 0.1);
      color: #48bb78;
    }
    .post-tag.language {
      background: rgba(237, 137, 54, 0.1);
      color: #ed8936;
    }
    .post-body {
      margin-bottom: 2rem;
    }
    .post-body h2 {
      font-size: 1.8rem;
      margin: 2rem 0 1rem;
      color: var(--primary);
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border);
    }
    .post-body h3 {
      font-size: 1.4rem;
      margin: 1.5rem 0 0.8rem;
      color: var(--primary);
    }
    .post-body p {
      margin-bottom: 1.2rem;
    }
    .post-body a {
      color: var(--primary);
      text-decoration: none;
    }
    .post-body a:hover {
      text-decoration: underline;
    }
    .post-body ul,
    .post-body ol {
      margin: 1rem 0 1.5rem 1.5rem;
    }
    .post-body li {
      margin-bottom: 0.5rem;
    }
    .post-body pre {
      background: #f8f9fa;
      color: #333333;
      padding: 1.5rem;
      border-radius: 8px;
      overflow-x: auto;
      margin: 1.5rem 0;
      border: 1px solid var(--border);
    }
    .post-body code {
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      font-size: 0.9rem;
    }
    .post-body pre code {
      background: none;
      padding: 0;
    }
    /* æš—é»‘æ¨¡å¼ä¸‹çš„ä»£ç å—æ ·å¼ */
    [data-theme="dark"] .post-body pre {
      background: #1e1e1e;
      color: #e6e6e6;
    }
    [data-theme="dark"] .post-body code {
      color: #e6e6e6;
    }
    .post-body img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin: 1.5rem 0;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .post-original-link {
      margin-top: 2rem;
      padding-top: 1rem;
      border-top: 1px dashed var(--border);
      color: #6c757d;
    }
    .post-original-link a {
      color: var(--primary);
      text-decoration: none;
    }
    .post-original-link a:hover {
      text-decoration: underline;
    }
    @media (max-width: 768px) {
      .post-content {
        padding: 0 1rem;
      }
      .post-header h1 {
        font-size: 1.8rem;
      }
      .post-tags {
        gap: 0.5rem;
      }
      .post-tag {
        padding: 0.4rem 0.8rem;
        font-size: 0.8rem;
      }
      .post-body pre {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
  <button class="theme-toggle" id="themeToggle" aria-label="åˆ‡æ¢ä¸»é¢˜">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
    </svg>
  </button>

  <button class="music-toggle" id="musicToggle" aria-label="æ§åˆ¶éŸ³ä¹">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>
  </button>

  <header>
    <h1>ğŸŒ± åŒ—è¾°çš„åšå®¢</h1>
    <p class="subtitle">è®°å½•æ€è€ƒï¼Œåˆ†äº«æˆé•¿ | ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„æ¢ç´¢è€…</p>
    <nav>
  <a href="../../../index.html">é¦–é¡µ</a>
  <a href="../../../project.html">é¡¹ç›®</a>
  <a href="../../../skill.html">æŠ€æœ¯</a>
  <a href="../../../daily.html">æ—¥å¸¸</a>
  <a href="../../../about.html">å…³äº</a>
  <a href="../../../archives.html">å½’æ¡£</a>
  <a href="https://github.com/" target="_blank" rel="noopener">GitHub</a>
</nav>
  </header>

  <main class="post-content">
    <article>
      <div class="post-header">
        <h1>é™æµæŠ€æœ¯è¯¦è§£ä¸å®è·µ</h1>
        <div class="post-meta">å‘å¸ƒæ—¥æœŸï¼š2026-02-14</div>
        
        
      </div>
      <div class="post-body">
        <h1>é™æµæŠ€æœ¯è¯¦è§£ä¸å®è·µ</h1>
<p></p>
<h2>ä¸€ã€é™æµçš„åŸºæœ¬æ¦‚å¿µ</h2>
<p></p>
<h3>1. ä»€ä¹ˆæ˜¯é™æµ</h3>
<p></p>
<p>é™æµï¼ˆRate Limitingï¼‰æ˜¯ä¸€ç§ä¿æŠ¤ç³»ç»Ÿçš„æœºåˆ¶ï¼Œé€šè¿‡é™åˆ¶å•ä½æ—¶é—´å†…çš„è¯·æ±‚æ•°é‡ï¼Œé˜²æ­¢ç³»ç»Ÿå› æµé‡è¿‡è½½è€Œå´©æºƒã€‚å®ƒæ˜¯é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡ä¸­çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä¸ç†”æ–­ã€é™çº§ä¸€èµ·æ„æˆäº†ç³»ç»Ÿçš„ä¿æŠ¤å±éšœã€‚</p>
<p></p>
<h3>2. ä¸ºä»€ä¹ˆéœ€è¦é™æµ</h3>
<p></p>
<ul><ol><li><strong>ä¿æŠ¤ç³»ç»Ÿç¨³å®šæ€§</strong>ï¼šé˜²æ­¢çªå‘æµé‡å¯¼è‡´ç³»ç»Ÿèµ„æºè€—å°½</li>
<li><strong>é˜²æ­¢æ¶æ„æ”»å‡»</strong>ï¼šæŠµå¾¡DDoSç­‰æ¶æ„è¯·æ±‚</li>
<li><strong>åˆç†åˆ†é…èµ„æº</strong>ï¼šç¡®ä¿æ¯ä¸ªç”¨æˆ·éƒ½èƒ½è·å¾—å…¬å¹³çš„æœåŠ¡</li>
<li><strong>é™ä½è¿è¥æˆæœ¬</strong>ï¼šé¿å…ä¸ºåº”å¯¹å³°å€¼æµé‡è€Œè¿‡åº¦æ‰©å®¹</li>
<p></p>
<h3>3. é™æµçš„å¸¸è§æŒ‡æ ‡</h3>
<p></p>
<li><strong>QPSï¼ˆQueries Per Secondï¼‰</strong>ï¼šæ¯ç§’æŸ¥è¯¢æ•°</li>
<li><strong>TPSï¼ˆTransactions Per Secondï¼‰</strong>ï¼šæ¯ç§’äº‹åŠ¡æ•°</li>
<li><strong>å¹¶å‘è¿æ¥æ•°</strong>ï¼šåŒæ—¶å¤„ç†çš„è¿æ¥æ•°é‡</li>
<li><strong>å¸¦å®½</strong>ï¼šç½‘ç»œä¼ è¾“é€Ÿç‡</li>
<p></p>
<h2>äºŒã€å¸¸è§çš„é™æµç®—æ³•</h2>
<p></p>
<h3>1. è®¡æ•°å™¨ç®—æ³•</h3>
<p></p>
<p><strong>åŸç†</strong>ï¼šç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæ¯æ¬¡è¯·æ±‚åˆ°æ¥æ—¶åŠ 1ï¼Œå½“è®¡æ•°å™¨è¶…è¿‡é˜ˆå€¼æ—¶æ‹’ç»è¯·æ±‚ï¼Œå®šæœŸé‡ç½®è®¡æ•°å™¨ã€‚</p>
<p></p>
<p><strong>ä¼˜ç‚¹</strong>ï¼šå®ç°ç®€å•</p>
<p><strong>ç¼ºç‚¹</strong>ï¼šå­˜åœ¨è¾¹ç•Œé—®é¢˜ï¼Œå¯èƒ½åœ¨é‡ç½®æ—¶ç¬é—´æ¥å—å¤§é‡è¯·æ±‚</p>
<p></p>
<h3>2. æ»‘åŠ¨çª—å£ç®—æ³•</h3>
<p></p>
<p><strong>åŸç†</strong>ï¼šå°†æ—¶é—´çª—å£åˆ†æˆå¤šä¸ªå°æ ¼å­ï¼Œæ¯ä¸ªæ ¼å­å¯¹åº”ä¸€ä¸ªè®¡æ•°å™¨ï¼Œçª—å£æ»‘åŠ¨æ—¶ç§»é™¤æ—§æ ¼å­å¹¶æ·»åŠ æ–°æ ¼å­ï¼Œç»Ÿè®¡çª—å£å†…çš„æ€»è¯·æ±‚æ•°ã€‚</p>
<p></p>
<p><strong>ä¼˜ç‚¹</strong>ï¼šè§£å†³äº†è®¡æ•°å™¨ç®—æ³•çš„è¾¹ç•Œé—®é¢˜</p>
<p><strong>ç¼ºç‚¹</strong>ï¼šå®ç°ç›¸å¯¹å¤æ‚</p>
<p></p>
<h3>3. ä»¤ç‰Œæ¡¶ç®—æ³•</h3>
<p></p>
<p><strong>åŸç†</strong>ï¼šç³»ç»Ÿä»¥å›ºå®šé€Ÿç‡å‘æ¡¶ä¸­æ”¾å…¥ä»¤ç‰Œï¼Œè¯·æ±‚åˆ°æ¥æ—¶éœ€è¦è·å–ä»¤ç‰Œæ‰èƒ½é€šè¿‡ï¼Œæ¡¶æ»¡æ—¶å¤šä½™çš„ä»¤ç‰Œä¼šè¢«ä¸¢å¼ƒã€‚</p>
<p></p>
<p><strong>ä¼˜ç‚¹</strong>ï¼šæ”¯æŒçªå‘æµé‡ï¼Œé…ç½®çµæ´»</p>
<p><strong>ç¼ºç‚¹</strong>ï¼šå®ç°ç¨å¤æ‚</p>
<p></p>
<h3>4. æ¼æ¡¶ç®—æ³•</h3>
<p></p>
<p><strong>åŸç†</strong>ï¼šè¯·æ±‚è¿›å…¥æ¼æ¡¶åï¼Œä»¥å›ºå®šé€Ÿç‡æµå‡ºï¼Œæ¡¶æ»¡æ—¶æ–°è¯·æ±‚è¢«æ‹’ç»ã€‚</p>
<p></p>
<p><strong>ä¼˜ç‚¹</strong>ï¼šå¹³æ»‘æµé‡ï¼Œé¿å…çªå‘</p>
<p><strong>ç¼ºç‚¹</strong>ï¼šæ— æ³•åº”å¯¹çŸ­æ—¶çªå‘æµé‡</p>
<p></p>
<h2>ä¸‰ã€ä½¿ç”¨Sentinelå®ç°é™æµ</h2>
<p></p>
<h3>1. Sentinelç®€ä»‹</h3>
<p></p>
<p>Sentinelæ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„é¢å‘åˆ†å¸ƒå¼æœåŠ¡æ¶æ„çš„é«˜å¯ç”¨æµé‡æ§åˆ¶ç»„ä»¶ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰ã€‚</p>
<p></p>
<h3>2. Sentinelçš„å®‰è£…ä¸é…ç½®</h3>
<p></p>
<h4>2.1 å¼•å…¥ä¾èµ–</h4>
<p></p>
<pre><code class="language-xml">&lt;dependency&gt;
<p>    &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt;</p>
<p>    &lt;artifactId&gt;sentinel-core&lt;/artifactId&gt;</p>
<p>    &lt;version&gt;1.8.6&lt;/version&gt;</p>
<p>&lt;/dependency&gt;</p>
<p></code></pre></p>
<p></p>
<h4>2.2 é…ç½®Sentinel Dashboardï¼ˆå¯é€‰ï¼‰</h4>
<p></p>
<p>Sentinel Dashboardæ˜¯ä¸€ä¸ªå¯è§†åŒ–çš„æ§åˆ¶å°ï¼Œå¯ä»¥å®æ—¶ç›‘æ§èµ„æºçš„æµé‡æ§åˆ¶å’Œç†”æ–­æƒ…å†µã€‚</p>
<p></p>
<pre><code class="language-bash">&lt;h1&gt;ä¸‹è½½Sentinel Dashboard&lt;/h1&gt;
<p>wget https://github.com/alibaba/Sentinel/releases/download/v1.8.6/sentinel-dashboard-1.8.6.jar</p>
<p></p>
<p>&lt;h1&gt;å¯åŠ¨Dashboard&lt;/h1&gt;</p>
<p>java -jar sentinel-dashboard-1.8.6.jar</p>
<p></code></pre></p>
<p></p>
<p>è®¿é—® <code>http://localhost:8080</code> å³å¯æ‰“å¼€æ§åˆ¶å°ï¼Œé»˜è®¤ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯ <code>sentinel</code>ã€‚</p>
<p></p>
<h3>3. Sentinelçš„åŸºæœ¬ä½¿ç”¨</h3>
<p></p>
<h4>3.1 å®šä¹‰èµ„æº</h4>
<p></p>
<pre><code class="language-java">import com.alibaba.csp.sentinel.slots.block.BlockException;
<p>import com.alibaba.csp.sentinel.slots.block.RuleConstant;</p>
<p>import com.alibaba.csp.sentinel.slots.block.flow.FlowRule;</p>
<p>import com.alibaba.csp.sentinel.slots.block.flow.FlowRuleManager;</p>
<p></p>
<p>import java.util.ArrayList;</p>
<p>import java.util.List;</p>
<p></p>
<p>public class SentinelDemo {</p>
<p></p>
<p>    public static void main(String[] args) {</p>
<p>        // é…ç½®æµæ§è§„åˆ™</p>
<p>        initFlowRules();</p>
<p></p>
<p>        // æ¨¡æ‹Ÿè¯·æ±‚</p>
<p>        for (int i = 0; i &lt; 20; i++) {</p>
<p>            try {</p>
<p>                // å®šä¹‰èµ„æº</p>
<p>                com.alibaba.csp.sentinel.Entry entry = com.alibaba.csp.sentinel.SphU.entry(&quot;HelloWorld&quot;);</p>
<p>                try {</p>
<p>                    // ä¸šåŠ¡é€»è¾‘</p>
<p>                    System.out.println(&quot;è¯·æ±‚é€šè¿‡ï¼Œæ—¶é—´ï¼š&quot; + System.currentTimeMillis());</p>
<p>                } finally {</p>
<p>                    entry.exit();</p>
<p>                }</p>
<p>            } catch (BlockException e) {</p>
<p>                // å¤„ç†è¢«é™æµçš„æƒ…å†µ</p>
<p>                System.out.println(&quot;è¯·æ±‚è¢«é™æµï¼Œæ—¶é—´ï¼š&quot; + System.currentTimeMillis());</p>
<p>            }</p>
<p>            // ä¼‘çœ 100ms</p>
<p>            try {</p>
<p>                Thread.sleep(100);</p>
<p>            } catch (InterruptedException e) {</p>
<p>                e.printStackTrace();</p>
<p>            }</p>
<p>        }</p>
<p>    }</p>
<p></p>
<p>    // åˆå§‹åŒ–æµæ§è§„åˆ™</p>
<p>    private static void initFlowRules() {</p>
<p>        List&lt;FlowRule&gt; rules = new ArrayList&lt;&gt;();</p>
<p>        FlowRule rule = new FlowRule();</p>
<p>        // èµ„æºåç§°</p>
<p>        rule.setResource(&quot;HelloWorld&quot;);</p>
<p>        // é™æµé˜ˆå€¼ç±»å‹ï¼šQPS</p>
<p>        rule.setGrade(RuleConstant.FLOW_GRADE_QPS);</p>
<p>        // é™æµé˜ˆå€¼ï¼šæ¯ç§’5ä¸ªè¯·æ±‚</p>
<p>        rule.setCount(5);</p>
<p>        rules.add(rule);</p>
<p>        FlowRuleManager.loadRules(rules);</p>
<p>    }</p>
<p>}</p>
<p></code></pre></p>
<p></p>
<h4>3.2 åŸºäºæ³¨è§£çš„æ–¹å¼</h4>
<p></p>
<pre><code class="language-java">import com.alibaba.csp.sentinel.annotation.SentinelResource;
<p>import com.alibaba.csp.sentinel.slots.block.BlockException;</p>
<p>import org.springframework.web.bind.annotation.GetMapping;</p>
<p>import org.springframework.web.bind.annotation.RestController;</p>
<p></p>
<p>@RestController</p>
<p>public class TestController {</p>
<p></p>
<p>    @GetMapping(&quot;/test&quot;)</p>
<p>    @SentinelResource(value = &quot;testResource&quot;, blockHandler = &quot;blockHandlerMethod&quot;)</p>
<p>    public String test() {</p>
<p>        return &quot;Hello, Sentinel!&quot;;</p>
<p>    }</p>
<p></p>
<p>    // å¤„ç†è¢«é™æµçš„æƒ…å†µ</p>
<p>    public String blockHandlerMethod(BlockException ex) {</p>
<p>        return &quot;è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•ï¼&quot;;</p>
<p>    }</p>
<p>}</p>
<p></code></pre></p>
<p></p>
<h3>4. Sentinelçš„é«˜çº§ç‰¹æ€§</h3>
<p></p>
<h4>4.1 çƒ­ç‚¹å‚æ•°é™æµ</h4>
<p></p>
<p>é’ˆå¯¹è¯·æ±‚ä¸­çš„çƒ­ç‚¹å‚æ•°è¿›è¡Œé™æµï¼Œä¾‹å¦‚é™åˆ¶æŸä¸ªç”¨æˆ·IDçš„è¯·æ±‚é¢‘ç‡ã€‚</p>
<p></p>
<pre><code class="language-java">// çƒ­ç‚¹å‚æ•°é™æµè§„åˆ™
<p>ParamFlowRule rule = new ParamFlowRule();</p>
<p>rule.setResource(&quot;hotResource&quot;);</p>
<p>// è®¾ç½®å‚æ•°ç´¢å¼•</p>
<p>rule.setParamIdx(0);</p>
<p>// è®¾ç½®é™æµé˜ˆå€¼</p>
<p>rule.setCount(5);</p>
<p>// åŠ è½½è§„åˆ™</p>
<p>ParamFlowRuleManager.loadRules(Collections.singletonList(rule));</p>
<p></code></pre></p>
<p></p>
<h4>4.2 é›†ç¾¤é™æµ</h4>
<p></p>
<p>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œå¯¹æ•´ä¸ªé›†ç¾¤çš„æµé‡è¿›è¡Œç»Ÿä¸€é™åˆ¶ã€‚</p>
<p></p>
<h4>4.3 ç†”æ–­é™çº§</h4>
<p></p>
<p>å½“æœåŠ¡å‡ºç°å¼‚å¸¸æ—¶ï¼Œè‡ªåŠ¨ç†”æ–­ä»¥é¿å…çº§è”æ•…éšœã€‚</p>
<p></p>
<h2>å››ã€ä½¿ç”¨ä»£ç ç»Ÿè®¡IPä»¥é™åˆ¶æµé‡</h2>
<p></p>
<h3>1. åŸºäºå†…å­˜çš„IPé™æµå®ç°</h3>
<p></p>
<p><strong>é€‚ç”¨äºå•æœºéƒ¨ç½²çš„å°å‹åº”ç”¨</strong></p>
<p></p>
<pre><code class="language-java">import java.util.Map;
<p>import java.util.concurrent.ConcurrentHashMap;</p>
<p>import java.util.concurrent.Executors;</p>
<p>import java.util.concurrent.ScheduledExecutorService;</p>
<p>import java.util.concurrent.TimeUnit;</p>
<p></p>
<p>public class IpRateLimiter {</p>
<p></p>
<p>    // å­˜å‚¨æ¯ä¸ªIPçš„è¯·æ±‚è®¡æ•°</p>
<p>    private final Map&lt;String, Integer&gt; ipCounter = new ConcurrentHashMap&lt;&gt;();</p>
<p>    // é™æµé˜ˆå€¼ï¼ˆæ¯ç§’è¯·æ±‚æ•°ï¼‰</p>
<p>    private final int limit;</p>
<p>    // å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± </p>
<p>    private final ScheduledExecutorService scheduler;</p>
<p></p>
<p>    public IpRateLimiter(int limit) {</p>
<p>        this.limit = limit;</p>
<p>        this.scheduler = Executors.newSingleThreadScheduledExecutor();</p>
<p>        // æ¯ç§’é‡ç½®è®¡æ•°å™¨</p>
<p>        this.scheduler.scheduleAtFixedRate(this::resetCounter, 1, 1, TimeUnit.SECONDS);</p>
<p>    }</p>
<p></p>
<p>    // æ£€æŸ¥IPæ˜¯å¦å…è®¸è®¿é—®</p>
<p>    public boolean allowRequest(String ip) {</p>
<p>        Integer count = ipCounter.getOrDefault(ip, 0);</p>
<p>        if (count &gt;= limit) {</p>
<p>            return false;</p>
<p>        }</p>
<p>        ipCounter.put(ip, count + 1);</p>
<p>        return true;</p>
<p>    }</p>
<p></p>
<p>    // é‡ç½®è®¡æ•°å™¨</p>
<p>    private void resetCounter() {</p>
<p>        ipCounter.clear();</p>
<p>    }</p>
<p></p>
<p>    // å…³é—­èµ„æº</p>
<p>    public void shutdown() {</p>
<p>        scheduler.shutdown();</p>
<p>    }</p>
<p>}</p>
<p></code></pre></p>
<p></p>
<h3>2. åŸºäºRedisçš„åˆ†å¸ƒå¼IPé™æµå®ç°</h3>
<p></p>
<p><strong>é€‚ç”¨äºåˆ†å¸ƒå¼éƒ¨ç½²çš„å¤§å‹åº”ç”¨</strong></p>
<p></p>
<pre><code class="language-java">import redis.clients.jedis.Jedis;
<p>import redis.clients.jedis.JedisPool;</p>
<p></p>
<p>public class DistributedIpRateLimiter {</p>
<p></p>
<p>    private final JedisPool jedisPool;</p>
<p>    private final int limit;</p>
<p>    private final int windowSeconds;</p>
<p></p>
<p>    public DistributedIpRateLimiter(JedisPool jedisPool, int limit, int windowSeconds) {</p>
<p>        this.jedisPool = jedisPool;</p>
<p>        this.limit = limit;</p>
<p>        this.windowSeconds = windowSeconds;</p>
<p>    }</p>
<p></p>
<p>    // æ£€æŸ¥IPæ˜¯å¦å…è®¸è®¿é—®</p>
<p>    public boolean allowRequest(String ip) {</p>
<p>        try (Jedis jedis = jedisPool.getResource()) {</p>
<p>            String key = &quot;rate_limit:&quot; + ip;</p>
<p>            // åŸå­é€’å¢</p>
<p>            long current = jedis.incr(key);</p>
<p>            </p>
<p>            // è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆä»…ç¬¬ä¸€æ¬¡è®¾ç½®ï¼‰</p>
<p>            if (current == 1) {</p>
<p>                jedis.expire(key, windowSeconds);</p>
<p>            }</p>
<p>            </p>
<p>            return current &lt;= limit;</p>
<p>        }</p>
<p>    }</p>
<p>}</p>
<p></code></pre></p>
<p></p>
<h3>3. åœ¨Spring Bootä¸­é›†æˆIPé™æµ</h3>
<p></p>
<pre><code class="language-java">import org.springframework.beans.factory.annotation.Autowired;
<p>import org.springframework.data.redis.core.RedisTemplate;</p>
<p>import org.springframework.stereotype.Component;</p>
<p>import org.springframework.web.servlet.HandlerInterceptor;</p>
<p></p>
<p>import javax.servlet.http.HttpServletRequest;</p>
<p>import javax.servlet.http.HttpServletResponse;</p>
<p>import java.util.concurrent.TimeUnit;</p>
<p></p>
<p>@Component</p>
<p>public class IpRateLimitInterceptor implements HandlerInterceptor {</p>
<p></p>
<p>    @Autowired</p>
<p>    private RedisTemplate&lt;String, String&gt; redisTemplate;</p>
<p></p>
<p>    // é™æµé˜ˆå€¼</p>
<p>    private static final int LIMIT = 10;</p>
<p>    // æ—¶é—´çª—å£ï¼ˆç§’ï¼‰</p>
<p>    private static final int WINDOW_SECONDS = 1;</p>
<p></p>
<p>    @Override</p>
<p>    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {</p>
<p>        String ip = request.getRemoteAddr();</p>
<p>        String key = &quot;rate_limit:&quot; + ip;</p>
<p>        </p>
<p>        // åŸå­é€’å¢</p>
<p>        Long current = redisTemplate.opsForValue().increment(key);</p>
<p>        </p>
<p>        // è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆä»…ç¬¬ä¸€æ¬¡è®¾ç½®ï¼‰</p>
<p>        if (current == 1) {</p>
<p>            redisTemplate.expire(key, WINDOW_SECONDS, TimeUnit.SECONDS);</p>
<p>        }</p>
<p>        </p>
<p>        if (current &gt; LIMIT) {</p>
<p>            response.setStatus(HttpServletResponse.SC_TOO_MANY_REQUESTS);</p>
<p>            response.setContentType(&quot;application/json;charset=UTF-8&quot;);</p>
<p>            response.getWriter().write(&quot;{\&quot;code\&quot;: 429, \&quot;message\&quot;: \&quot;è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•\&quot;}&quot;);</p>
<p>            return false;</p>
<p>        }</p>
<p>        </p>
<p>        return true;</p>
<p>    }</p>
<p>}</p>
<p></code></pre></p>
<p></p>
<h2>äº”ã€é™æµçš„æœ€ä½³å®è·µ</h2>
<p></p>
<h3>1. é€‰æ‹©åˆé€‚çš„é™æµç­–ç•¥</h3>
<p></p>
<li><strong>APIç½‘å…³å±‚</strong>ï¼šä½¿ç”¨ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œæ”¯æŒçªå‘æµé‡</li>
<li><strong>åº”ç”¨å±‚</strong>ï¼šæ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„ç®—æ³•</li>
<li><strong>æ•°æ®åº“å±‚</strong>ï¼šä½¿ç”¨æ¼æ¡¶ç®—æ³•ï¼Œå¹³æ»‘æ•°æ®åº“å‹åŠ›</li>
<p></p>
<h3>2. åˆç†è®¾ç½®é™æµé˜ˆå€¼</h3>
<p></p>
<li><strong>åŸºäºç³»ç»Ÿå®¹é‡</strong>ï¼šæ ¹æ®æœåŠ¡å™¨çš„CPUã€å†…å­˜ç­‰èµ„æºè®¾ç½®</li>
<li><strong>åŸºäºä¸šåŠ¡éœ€æ±‚</strong>ï¼šæ ¹æ®ä¸šåŠ¡çš„QPSç›®æ ‡è®¾ç½®</li>
<li><strong>åŠ¨æ€è°ƒæ•´</strong>ï¼šæ ¹æ®ç³»ç»Ÿè´Ÿè½½åŠ¨æ€è°ƒæ•´é˜ˆå€¼</li>
<p></p>
<h3>3. é™æµä¸ç†”æ–­ã€é™çº§é…åˆä½¿ç”¨</h3>
<p></p>
<li><strong>é™æµ</strong>ï¼šæ§åˆ¶è¿›å…¥ç³»ç»Ÿçš„è¯·æ±‚æ•°é‡</li>
<li><strong>ç†”æ–­</strong>ï¼šå½“æœåŠ¡å¼‚å¸¸æ—¶æ–­å¼€è°ƒç”¨</li>
<li><strong>é™çº§</strong>ï¼šå½“ç³»ç»Ÿå‹åŠ›è¿‡å¤§æ—¶ï¼Œå…³é—­éƒ¨åˆ†éæ ¸å¿ƒåŠŸèƒ½</li>
<p></p>
<h3>4. ç›‘æ§ä¸å‘Šè­¦</h3>
<p></p>
<li><strong>å®æ—¶ç›‘æ§</strong>ï¼šç›‘æ§é™æµçš„è§¦å‘æƒ…å†µ</li>
<li><strong>å‘Šè­¦æœºåˆ¶</strong>ï¼šå½“é™æµé¢‘ç¹è§¦å‘æ—¶åŠæ—¶å‘Šè­¦</li>
<li><strong>æ•°æ®åˆ†æ</strong>ï¼šåˆ†ææµé‡æ¨¡å¼ï¼Œä¼˜åŒ–é™æµç­–ç•¥</li></ol></ul>
<p></p>
<h2>å…­ã€æ€»ç»“</h2>
<p></p>
<p>é™æµæ˜¯ä¿æŠ¤ç³»ç»Ÿç¨³å®šæ€§çš„é‡è¦æ‰‹æ®µï¼Œé€šè¿‡åˆç†çš„é™æµç­–ç•¥ï¼Œå¯ä»¥åœ¨ä¿è¯ç³»ç»Ÿå¯ç”¨æ€§çš„åŒæ—¶ï¼Œä¸ºç”¨æˆ·æä¾›æ›´å¥½çš„æœåŠ¡ä½“éªŒã€‚æœ¬æ–‡ä»‹ç»äº†å¸¸è§çš„é™æµç®—æ³•ã€ä½¿ç”¨Sentinelå®ç°é™æµä»¥åŠåŸºäºIPçš„æµé‡é™åˆ¶å®ç°ï¼Œå¸Œæœ›å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ã€‚</p>
<p></p>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯å’Œç³»ç»Ÿæ¶æ„é€‰æ‹©åˆé€‚çš„é™æµæ–¹æ¡ˆï¼Œå¹¶ç»“åˆç›‘æ§å’Œå‘Šè­¦æœºåˆ¶ï¼Œä¸æ–­ä¼˜åŒ–é™æµç­–ç•¥ï¼Œä»¥è¾¾åˆ°æœ€ä½³çš„ç³»ç»Ÿä¿æŠ¤æ•ˆæœã€‚</p>
      </div>
    </article>
  </main>

  <footer>
    <p>Â© 2026 åŒ—è¾° Â· ä¿æŒå¥½å¥‡ï¼ŒæŒç»­æˆé•¿</p>
    <p style="margin-top: 6px; font-size: 0.9rem; color: #aaa;">
      æœ¬åšå®¢é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc/4.0/" style="color: var(--primary);">CC BY-NC 4.0</a> è®¸å¯ | 
      æºç æ‰˜ç®¡äº <a href="https://github.com/" style="color: var(--primary);">GitHub</a>
    </p>
  </footer>

  <button class="back-to-top" id="backToTop" aria-label="å›åˆ°é¡¶éƒ¨">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="m18 15-6-6-6 6"/>
    </svg>
  </button>

  <script src="../../../../js/theme.js"></script>
</body>
</html>
  