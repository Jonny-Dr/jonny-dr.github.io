
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Redis ç¼“å­˜ç©¿é€/å‡»ç©¿/é›ªå´©è§£å†³æ–¹æ¡ˆ | åŒ—è¾°</title>
  <link rel="stylesheet" href="../../../../css/common.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  <style>
    .post-content {
      max-width: 800px;
      margin: 0 auto;
      line-height: 1.8;
    }
    .post-header {
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }
    .post-header h1 {
      font-size: 2.2rem;
      margin-bottom: 1rem;
      color: var(--primary);
    }
    .post-meta {
      color: #888;
      font-size: 0.95rem;
      margin-bottom: 1rem;
    }
    .post-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
      margin-bottom: 1rem;
    }
    .post-tag {
      background: rgba(67, 97, 238, 0.1);
      color: var(--primary);
      padding: 0.5rem 1rem;
      border-radius: 15px;
      font-size: 0.9rem;
      font-weight: 600;
    }
    .post-tag.category {
      background: rgba(72, 187, 120, 0.1);
      color: #48bb78;
    }
    .post-tag.language {
      background: rgba(237, 137, 54, 0.1);
      color: #ed8936;
    }
    .post-body {
      margin-bottom: 2rem;
    }
    .post-body h2 {
      font-size: 1.8rem;
      margin: 2rem 0 1rem;
      color: var(--primary);
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border);
    }
    .post-body h3 {
      font-size: 1.4rem;
      margin: 1.5rem 0 0.8rem;
      color: var(--primary);
    }
    .post-body p {
      margin-bottom: 1.2rem;
    }
    .post-body a {
      color: var(--primary);
      text-decoration: none;
    }
    .post-body a:hover {
      text-decoration: underline;
    }
    .post-body ul,
    .post-body ol {
      margin: 1rem 0 1.5rem 1.5rem;
    }
    .post-body li {
      margin-bottom: 0.5rem;
    }
    .post-body pre {
      background: #f8f9fa;
      color: #333333;
      padding: 1.5rem;
      border-radius: 8px;
      overflow-x: auto;
      margin: 1.5rem 0;
      border: 1px solid var(--border);
    }
    .post-body code {
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      font-size: 0.9rem;
    }
    .post-body pre code {
      background: none;
      padding: 0;
    }
    /* æš—é»‘æ¨¡å¼ä¸‹çš„ä»£ç å—æ ·å¼ */
    [data-theme="dark"] .post-body pre {
      background: #1e1e1e;
      color: #e6e6e6;
    }
    [data-theme="dark"] .post-body code {
      color: #e6e6e6;
    }
    .post-body img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin: 1.5rem 0;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .post-original-link {
      margin-top: 2rem;
      padding-top: 1rem;
      border-top: 1px dashed var(--border);
      color: #6c757d;
    }
    .post-original-link a {
      color: var(--primary);
      text-decoration: none;
    }
    .post-original-link a:hover {
      text-decoration: underline;
    }
    @media (max-width: 768px) {
      .post-content {
        padding: 0 1rem;
      }
      .post-header h1 {
        font-size: 1.8rem;
      }
      .post-tags {
        gap: 0.5rem;
      }
      .post-tag {
        padding: 0.4rem 0.8rem;
        font-size: 0.8rem;
      }
      .post-body pre {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
  <button class="theme-toggle" id="themeToggle" aria-label="åˆ‡æ¢ä¸»é¢˜">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
    </svg>
  </button>

  <button class="music-toggle" id="musicToggle" aria-label="æ§åˆ¶éŸ³ä¹">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>
  </button>

  <header>
    <h1>ğŸŒ± åŒ—è¾°çš„åšå®¢</h1>
    <p class="subtitle">è®°å½•æ€è€ƒï¼Œåˆ†äº«æˆé•¿ | ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„æ¢ç´¢è€…</p>
    <nav>
  <a href="../../../index.html">é¦–é¡µ</a>
  <a href="../../../project.html">é¡¹ç›®</a>
  <a href="../../../skill.html">æŠ€æœ¯</a>
  <a href="../../../daily.html">æ—¥å¸¸</a>
  <a href="../../../about.html">å…³äº</a>
  <a href="../../../archives.html">å½’æ¡£</a>
  <a href="https://github.com/" target="_blank" rel="noopener">GitHub</a>
</nav>
  </header>

  <main class="post-content">
    <article>
      <div class="post-header">
        <h1>Redis ç¼“å­˜ç©¿é€/å‡»ç©¿/é›ªå´©è§£å†³æ–¹æ¡ˆ</h1>
        <div class="post-meta">å‘å¸ƒæ—¥æœŸï¼š2026-02-15</div>
        
        <div class="post-tags">
          <span class="post-tag category">ç¼“å­˜ä¸­é—´ä»¶</span> <span class="post-tag category">æ€§èƒ½ä¼˜åŒ–</span>
          <span class="post-tag language">Java</span> <span class="post-tag language">Redis</span>
        </div>
        
      </div>
      <div class="post-body">
        <h1>Redis ç¼“å­˜ç©¿é€/å‡»ç©¿/é›ªå´©è§£å†³æ–¹æ¡ˆ</h1>
<p></p>
<h2>é—®é¢˜èƒŒæ™¯</h2>
<p></p>
<p>åœ¨é«˜å¹¶å‘ç³»ç»Ÿä¸­ï¼Œç¼“å­˜æ˜¯æå‡æ€§èƒ½çš„å…³é”®ç»„ä»¶ï¼Œä½†åŒæ—¶ä¹Ÿä¼šé¢ä¸´å„ç§ç¼“å­˜ç›¸å…³çš„é—®é¢˜ã€‚Redisä½œä¸ºæœ€å¸¸ç”¨çš„ç¼“å­˜ä¸­é—´ä»¶ï¼Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ç»å¸¸é‡åˆ°ä»¥ä¸‹ä¸‰å¤§é—®é¢˜ï¼š</p>
<p></p>
<ol><li><strong>ç¼“å­˜ç©¿é€</strong>ï¼šè¯·æ±‚ä¸å­˜åœ¨çš„æ•°æ®ï¼Œå¯¼è‡´è¯·æ±‚ç›´æ¥ç©¿é€åˆ°æ•°æ®åº“</li>
<li><strong>ç¼“å­˜å‡»ç©¿</strong>ï¼šçƒ­ç‚¹æ•°æ®è¿‡æœŸï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚åŒæ—¶ç©¿é€åˆ°æ•°æ®åº“</li>
<li><strong>ç¼“å­˜é›ªå´©</strong>ï¼šå¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›éª¤å¢</li></ol>
<p></p>
<p>æœ¬æ–‡å°†æ·±å…¥åˆ†æè¿™äº›é—®é¢˜çš„åŸå› ï¼Œå¹¶æä¾›å®Œæ•´çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p></p>
<h2>ç¼“å­˜ç©¿é€</h2>
<p></p>
<h3>é—®é¢˜åˆ†æ</h3>
<p></p>
<p>ç¼“å­˜ç©¿é€æ˜¯æŒ‡ç”¨æˆ·è¯·æ±‚çš„æ•°æ®åœ¨ç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œä¸”åœ¨æ•°æ®åº“ä¸­ä¹Ÿä¸å­˜åœ¨ï¼Œå¯¼è‡´è¯·æ±‚æ¯æ¬¡éƒ½ä¼šç©¿é€ç¼“å­˜ç›´æ¥è®¿é—®æ•°æ®åº“ã€‚å¦‚æœæ¶æ„æ”»å‡»è€…å¤§é‡å‘é€è¿™æ ·çš„è¯·æ±‚ï¼Œä¼šå¯¼è‡´æ•°æ®åº“å‹åŠ›è¿‡å¤§ï¼Œç”šè‡³å´©æºƒã€‚</p>
<p></p>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<p></p>
<h4>1. å¸ƒéš†è¿‡æ»¤å™¨</h4>
<p></p>
<p>å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§ç©ºé—´æ•ˆç‡å¾ˆé«˜çš„æ¦‚ç‡å‹æ•°æ®ç»“æ„ï¼Œç”¨äºåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨æ¥è¿‡æ»¤æ‰ä¸å­˜åœ¨çš„æ•°æ®è¯·æ±‚ã€‚</p>
<p></p>
<pre><code class="language-java">// ä½¿ç”¨Guavaçš„å¸ƒéš†è¿‡æ»¤å™¨
<p>import com.google.common.hash.BloomFilter;</p>
<p>import com.google.common.hash.Funnels;</p>
<p></p>
<p>// åˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨</p>
<p>BloomFilter&lt;Long&gt; bloomFilter = BloomFilter.create(</p>
<p>    Funnels.longFunnel(),</p>
<p>    1000000, // é¢„è®¡å…ƒç´ æ•°é‡</p>
<p>    0.01     // è¯¯åˆ¤ç‡</p>
<p>);</p>
<p></p>
<p>// å°†æ•°æ®åº“ä¸­çš„idåŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨</p>
<p>for (Long id : getAllIdsFromDatabase()) {</p>
<p>    bloomFilter.put(id);</p>
<p>}</p>
<p></p>
<p>// åœ¨æŸ¥è¯¢å‰ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­</p>
<p>public String getProductById(Long id) {</p>
<p>    // å…ˆé€šè¿‡å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­idæ˜¯å¦å­˜åœ¨</p>
<p>    if (!bloomFilter.mightContain(id)) {</p>
<p>        return &quot;å•†å“ä¸å­˜åœ¨&quot;;</p>
<p>    }</p>
<p>    </p>
<p>    // ä»ç¼“å­˜æŸ¥è¯¢</p>
<p>    String product = redisTemplate.opsForValue().get(&quot;product:&quot; + id);</p>
<p>    if (product != null) {</p>
<p>        return product;</p>
<p>    }</p>
<p>    </p>
<p>    // ä»æ•°æ®åº“æŸ¥è¯¢</p>
<p>    product = productService.getProductById(id);</p>
<p>    if (product != null) {</p>
<p>        // æ”¾å…¥ç¼“å­˜</p>
<p>        redisTemplate.opsForValue().set(&quot;product:&quot; + id, product, 30, TimeUnit.MINUTES);</p>
<p>    } else {</p>
<p>        // å¯¹äºä¸å­˜åœ¨çš„æ•°æ®ï¼Œä¹Ÿæ”¾å…¥ç¼“å­˜ï¼Œè®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´</p>
<p>        redisTemplate.opsForValue().set(&quot;product:&quot; + id, &quot;&quot;, 5, TimeUnit.MINUTES);</p>
<p>    }</p>
<p>    return product;</p>
<p>}</p>
<p></code></pre></p>
<p></p>
<h4>2. ç¼“å­˜ç©ºå¯¹è±¡</h4>
<p></p>
<p>å¯¹äºä¸å­˜åœ¨çš„æ•°æ®ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å…¶ç¼“å­˜èµ·æ¥ï¼Œè®¾ç½®ä¸€ä¸ªè¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·åç»­çš„ç›¸åŒè¯·æ±‚å°±ä¼šè¢«ç¼“å­˜æ‹¦æˆªã€‚</p>
<p></p>
<pre><code class="language-java">public String getProductById(Long id) {
<p>    // ä»ç¼“å­˜æŸ¥è¯¢</p>
<p>    String product = redisTemplate.opsForValue().get(&quot;product:&quot; + id);</p>
<p>    if (product != null) {</p>
<p>        // å¦‚æœæ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œè¯´æ˜æ˜¯ä¹‹å‰ç¼“å­˜çš„ä¸å­˜åœ¨çš„æ•°æ®</p>
<p>        return product.equals(&quot;&quot;) ? &quot;å•†å“ä¸å­˜åœ¨&quot; : product;</p>
<p>    }</p>
<p>    </p>
<p>    // ä»æ•°æ®åº“æŸ¥è¯¢</p>
<p>    product = productService.getProductById(id);</p>
<p>    if (product != null) {</p>
<p>        // æ”¾å…¥ç¼“å­˜</p>
<p>        redisTemplate.opsForValue().set(&quot;product:&quot; + id, product, 30, TimeUnit.MINUTES);</p>
<p>    } else {</p>
<p>        // å¯¹äºä¸å­˜åœ¨çš„æ•°æ®ï¼Œä¹Ÿæ”¾å…¥ç¼“å­˜ï¼Œè®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´</p>
<p>        redisTemplate.opsForValue().set(&quot;product:&quot; + id, &quot;&quot;, 5, TimeUnit.MINUTES);</p>
<p>        product = &quot;å•†å“ä¸å­˜åœ¨&quot;;</p>
<p>    }</p>
<p>    return product;</p>
<p>}</p>
<p></code></pre></p>
<p></p>
<h2>ç¼“å­˜å‡»ç©¿</h2>
<p></p>
<h3>é—®é¢˜åˆ†æ</h3>
<p></p>
<p>ç¼“å­˜å‡»ç©¿æ˜¯æŒ‡ä¸€ä¸ªçƒ­ç‚¹æ•°æ®è¿‡æœŸæ—¶ï¼Œæ­£å¥½æœ‰å¤§é‡è¯·æ±‚åŒæ—¶è®¿é—®è¯¥æ•°æ®ï¼Œå¯¼è‡´æ‰€æœ‰è¯·æ±‚éƒ½ç©¿é€åˆ°æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“ç¬é—´å‹åŠ›è¿‡å¤§ã€‚</p>
<p></p>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<p></p>
<h4>1. è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ</h4>
<p></p>
<p>å¯¹äºç‰¹åˆ«çƒ­ç‚¹çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®å…¶åœ¨ç¼“å­˜ä¸­æ°¸ä¸è¿‡æœŸï¼Œç„¶åé€šè¿‡åå°ä»»åŠ¡å®šæœŸæ›´æ–°ã€‚</p>
<p></p>
<pre><code class="language-java">// è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ
<p>redisTemplate.opsForValue().set(&quot;hot:product:&quot; + id, product);</p>
<p></p>
<p>// åå°ä»»åŠ¡å®šæœŸæ›´æ–°</p>
<p>@Scheduled(fixedRate = 60000) // æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡</p>
<p>public void updateHotProducts() {</p>
<p>    List&lt;Product&gt; hotProducts = productService.getHotProducts();</p>
<p>    for (Product product : hotProducts) {</p>
<p>        redisTemplate.opsForValue().set(&quot;hot:product:&quot; + product.getId(), product);</p>
<p>    }</p>
<p>}</p>
<p></code></pre></p>
<p></p>
<h4>2. ä½¿ç”¨äº’æ–¥é”</h4>
<p></p>
<p>å½“ç¼“å­˜è¿‡æœŸæ—¶ï¼Œåªå…è®¸ä¸€ä¸ªçº¿ç¨‹å»æ•°æ®åº“æŸ¥è¯¢å¹¶æ›´æ–°ç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…ã€‚</p>
<p></p>
<pre><code class="language-java">public String getProductById(Long id) {
<p>    // ä»ç¼“å­˜æŸ¥è¯¢</p>
<p>    String product = redisTemplate.opsForValue().get(&quot;product:&quot; + id);</p>
<p>    if (product != null) {</p>
<p>        return product;</p>
<p>    }</p>
<p>    </p>
<p>    // ç¼“å­˜ä¸å­˜åœ¨ï¼Œå°è¯•è·å–é”</p>
<p>    String lockKey = &quot;lock:product:&quot; + id;</p>
<p>    Boolean locked = redisTemplate.opsForValue().setIfAbsent(lockKey, &quot;1&quot;, 3, TimeUnit.SECONDS);</p>
<p>    </p>
<p>    if (locked != null &amp;&amp; locked) {</p>
<p>        try {</p>
<p>            // å†æ¬¡æ£€æŸ¥ç¼“å­˜ï¼Œé˜²æ­¢å…¶ä»–çº¿ç¨‹å·²ç»æ›´æ–°</p>
<p>            product = redisTemplate.opsForValue().get(&quot;product:&quot; + id);</p>
<p>            if (product != null) {</p>
<p>                return product;</p>
<p>            }</p>
<p>            </p>
<p>            // ä»æ•°æ®åº“æŸ¥è¯¢</p>
<p>            product = productService.getProductById(id);</p>
<p>            if (product != null) {</p>
<p>                // æ”¾å…¥ç¼“å­˜</p>
<p>                redisTemplate.opsForValue().set(&quot;product:&quot; + id, product, 30, TimeUnit.MINUTES);</p>
<p>            }</p>
<p>        } finally {</p>
<p>            // é‡Šæ”¾é”</p>
<p>            redisTemplate.delete(lockKey);</p>
<p>        }</p>
<p>    } else {</p>
<p>        // å…¶ä»–çº¿ç¨‹æ­£åœ¨æ›´æ–°ç¼“å­˜ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´åé‡è¯•</p>
<p>        try {</p>
<p>            Thread.sleep(50);</p>
<p>        } catch (InterruptedException e) {</p>
<p>            Thread.currentThread().interrupt();</p>
<p>        }</p>
<p>        // é‡è¯•</p>
<p>        return getProductById(id);</p>
<p>    }</p>
<p>    </p>
<p>    return product;</p>
<p>}</p>
<p></code></pre></p>
<p></p>
<h2>ç¼“å­˜é›ªå´©</h2>
<p></p>
<h3>é—®é¢˜åˆ†æ</h3>
<p></p>
<p>ç¼“å­˜é›ªå´©æ˜¯æŒ‡å¤§é‡ç¼“å­˜æ•°æ®åœ¨åŒä¸€æ—¶é—´è¿‡æœŸï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚åŒæ—¶ç©¿é€åˆ°æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“å‹åŠ›éª¤å¢ï¼Œç”šè‡³å´©æºƒã€‚</p>
<p></p>
<h3>è§£å†³æ–¹æ¡ˆ</h3>
<p></p>
<h4>1. è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´</h4>
<p></p>
<p>ä¸ºç¼“å­˜è®¾ç½®éšæœºçš„è¿‡æœŸæ—¶é—´ï¼Œé¿å…å¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸã€‚</p>
<p></p>
<pre><code class="language-java">// è®¾ç½®éšæœºè¿‡æœŸæ—¶é—´
<p>int expireTime = 30 + new Random().nextInt(60); // 30-90åˆ†é’Ÿ</p>
<p>redisTemplate.opsForValue().set(&quot;product:&quot; + id, product, expireTime, TimeUnit.MINUTES);</p>
<p></code></pre></p>
<p></p>
<h4>2. åˆ†å±‚ç¼“å­˜ç­–ç•¥</h4>
<p></p>
<p>ä½¿ç”¨å¤šå±‚ç¼“å­˜ï¼Œä¸åŒå±‚çº§çš„ç¼“å­˜è®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ã€‚</p>
<p></p>
<pre><code class="language-java">// æœ¬åœ°ç¼“å­˜ï¼ˆCaffeineï¼‰
<p>private Cache&lt;Long, String&gt; localCache = Caffeine.newBuilder()</p>
<p>    .expireAfterWrite(5, TimeUnit.MINUTES)</p>
<p>    .maximumSize(1000)</p>
<p>    .build();</p>
<p></p>
<p>public String getProductById(Long id) {</p>
<p>    // å…ˆä»æœ¬åœ°ç¼“å­˜æŸ¥è¯¢</p>
<p>    String product = localCache.getIfPresent(id);</p>
<p>    if (product != null) {</p>
<p>        return product;</p>
<p>    }</p>
<p>    </p>
<p>    // ä»Redisç¼“å­˜æŸ¥è¯¢</p>
<p>    product = redisTemplate.opsForValue().get(&quot;product:&quot; + id);</p>
<p>    if (product != null) {</p>
<p>        // æ›´æ–°æœ¬åœ°ç¼“å­˜</p>
<p>        localCache.put(id, product);</p>
<p>        return product;</p>
<p>    }</p>
<p>    </p>
<p>    // ä»æ•°æ®åº“æŸ¥è¯¢</p>
<p>    product = productService.getProductById(id);</p>
<p>    if (product != null) {</p>
<p>        // è®¾ç½®Redisç¼“å­˜ï¼Œéšæœºè¿‡æœŸæ—¶é—´</p>
<p>        int expireTime = 30 + new Random().nextInt(60);</p>
<p>        redisTemplate.opsForValue().set(&quot;product:&quot; + id, product, expireTime, TimeUnit.MINUTES);</p>
<p>        // æ›´æ–°æœ¬åœ°ç¼“å­˜</p>
<p>        localCache.put(id, product);</p>
<p>    }</p>
<p>    </p>
<p>    return product;</p>
<p>}</p>
<p></code></pre></p>
<p></p>
<h4>3. ç¼“å­˜é¢„çƒ­</h4>
<p></p>
<p>åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œä¸»åŠ¨å°†çƒ­ç‚¹æ•°æ®åŠ è½½åˆ°ç¼“å­˜ä¸­ã€‚</p>
<p></p>
<pre><code class="language-java">// ç³»ç»Ÿå¯åŠ¨æ—¶é¢„çƒ­ç¼“å­˜
<p>@PostConstruct</p>
<p>public void warmupCache() {</p>
<p>    List&lt;Product&gt; hotProducts = productService.getHotProducts();</p>
<p>    for (Product product : hotProducts) {</p>
<p>        int expireTime = 30 + new Random().nextInt(60);</p>
<p>        redisTemplate.opsForValue().set(&quot;product:&quot; + product.getId(), product, expireTime, TimeUnit.MINUTES);</p>
<p>    }</p>
<p>    System.out.println(&quot;ç¼“å­˜é¢„çƒ­å®Œæˆï¼Œå…±åŠ è½½&quot; + hotProducts.size() + &quot;ä¸ªçƒ­ç‚¹å•†å“&quot;);</p>
<p>}</p>
<p></code></pre></p>
<p></p>
<h4>4. é™çº§ä¸é™æµ</h4>
<p></p>
<p>å½“ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œä½¿ç”¨é™çº§ç­–ç•¥ï¼Œè¿”å›é»˜è®¤å€¼æˆ–ç¼“å­˜å¿«ç…§ï¼ŒåŒæ—¶å¯¹æ•°æ®åº“è®¿é—®è¿›è¡Œé™æµã€‚</p>
<p></p>
<pre><code class="language-java">// ä½¿ç”¨Sentinelè¿›è¡Œé™æµ
<p>@SentinelResource(value = &quot;getProduct&quot;, fallback = &quot;fallbackGetProduct&quot;)</p>
<p>public String getProductById(Long id) {</p>
<p>    // ç¼“å­˜æŸ¥è¯¢é€»è¾‘</p>
<p>    // ...</p>
<p>}</p>
<p></p>
<p>public String fallbackGetProduct(Long id) {</p>
<p>    // è¿”å›ç¼“å­˜å¿«ç…§æˆ–é»˜è®¤å€¼</p>
<p>    return getProductSnapshot(id);</p>
<p>}</p>
<p></code></pre></p>
<p></p>
<h2>ä»£ç ä¼˜åŒ–å»ºè®®</h2>
<p></p>
<h3>1. ä½¿ç”¨RedisTemplateçš„æœ€ä½³å®è·µ</h3>
<p></p>
<pre><code class="language-java">// æ­£ç¡®ä½¿ç”¨RedisTemplate
<p>@Configuration</p>
<p>public class RedisConfig {</p>
<p>    @Bean</p>
<p>    public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory factory) {</p>
<p>        RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;&gt;();</p>
<p>        template.setConnectionFactory(factory);</p>
<p>        </p>
<p>        // è®¾ç½®é”®çš„åºåˆ—åŒ–æ–¹å¼</p>
<p>        template.setKeySerializer(new StringRedisSerializer());</p>
<p>        // è®¾ç½®å€¼çš„åºåˆ—åŒ–æ–¹å¼</p>
<p>        template.setValueSerializer(new Jackson2JsonRedisSerializer&lt;&gt;(Object.class));</p>
<p>        </p>
<p>        template.afterPropertiesSet();</p>
<p>        return template;</p>
<p>    }</p>
<p>}</p>
<p></code></pre></p>
<p></p>
<h3>2. ä½¿ç”¨Redis Pipelineæå‡æ€§èƒ½</h3>
<p></p>
<p>å¯¹äºæ‰¹é‡æ“ä½œï¼Œä½¿ç”¨Pipelineå¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½ã€‚</p>
<p></p>
<pre><code class="language-java">// ä½¿ç”¨Pipelineæ‰¹é‡è®¾ç½®ç¼“å­˜
<p>public void batchSetProducts(List&lt;Product&gt; products) {</p>
<p>    redisTemplate.executePipelined((RedisCallback&lt;Object&gt;) connection -&gt; {</p>
<p>        StringRedisConnection stringRedisConnection = (StringRedisConnection) connection;</p>
<p>        for (Product product : products) {</p>
<p>            int expireTime = 30 + new Random().nextInt(60);</p>
<p>            stringRedisConnection.setEx(</p>
<p>                &quot;product:&quot; + product.getId(),</p>
<p>                expireTime <em> 60, // è½¬æ¢ä¸ºç§’</p>
<p>                JSON.toJSONString(product)</p>
<p>            );</p>
<p>        }</p>
<p>        return null;</p>
<p>    });</p>
<p>}</p>
<p></code></pre></p>
<p></p>
<h3>3. ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡</h3>
<p></p>
<p>å®šæœŸç›‘æ§ç¼“å­˜çš„å‘½ä¸­ç‡ï¼ŒåŠæ—¶å‘ç°é—®é¢˜ã€‚</p>
<p></p>
<pre><code class="language-java">// ç¼“å­˜ç›‘æ§
<p>@Component</p>
<p>public class CacheMonitor {</p>
<p>    private AtomicLong totalRequests = new AtomicLong(0);</p>
<p>    private AtomicLong cacheHits = new AtomicLong(0);</p>
<p>    </p>
<p>    public void recordRequest() {</p>
<p>        totalRequests.incrementAndGet();</p>
<p>    }</p>
<p>    </p>
<p>    public void recordHit() {</p>
<p>        cacheHits.incrementAndGet();</p>
<p>    }</p>
<p>    </p>
<p>    @Scheduled(fixedRate = 60000) // æ¯åˆ†é’Ÿæ‰“å°ä¸€æ¬¡</p>
<p>    public void printStats() {</p>
<p>        long total = totalRequests.get();</p>
<p>        long hits = cacheHits.get();</p>
<p>        double hitRate = total &gt; 0 ? (double) hits / total : 0;</p>
<p>        System.out.println(&quot;ç¼“å­˜å‘½ä¸­ç‡: &quot; + String.format(&quot;%.2f%%&quot;, hitRate </em> 100));</p>
<p>        </p>
<p>        // é‡ç½®è®¡æ•°å™¨</p>
<p>        totalRequests.set(0);</p>
<p>        cacheHits.set(0);</p>
<p>    }</p>
<p>}</p>
<p></code></pre></p>
<p></p>
<h2>æ€»ç»“</h2>
<p></p>
<p>é€šè¿‡æœ¬æ–‡çš„åˆ†æå’Œè§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥æœ‰æ•ˆåœ°åº”å¯¹Redisç¼“å­˜çš„ä¸‰å¤§é—®é¢˜ï¼š</p>
<p></p>
<p>| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |</p>
<p>|------|------|----------|</p>
<p>| ç¼“å­˜ç©¿é€ | è¯·æ±‚ä¸å­˜åœ¨çš„æ•°æ® | å¸ƒéš†è¿‡æ»¤å™¨ + ç¼“å­˜ç©ºå¯¹è±¡ |</p>
<p>| ç¼“å­˜å‡»ç©¿ | çƒ­ç‚¹æ•°æ®è¿‡æœŸ | æ°¸ä¸è¿‡æœŸ + äº’æ–¥é” |</p>
<p>| ç¼“å­˜é›ªå´© | å¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸ | éšæœºè¿‡æœŸæ—¶é—´ + åˆ†å±‚ç¼“å­˜ + ç¼“å­˜é¢„çƒ­ |</p>
<p></p>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥æ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„è§£å†³æ–¹æ¡ˆï¼Œç”šè‡³ç»„åˆä½¿ç”¨å¤šç§æ–¹æ¡ˆï¼Œä»¥è¾¾åˆ°æœ€ä½³çš„ç¼“å­˜æ•ˆæœã€‚</p>
<p></p>
<p>åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜åº”è¯¥å»ºç«‹å®Œå–„çš„ç¼“å­˜ç›‘æ§æœºåˆ¶ï¼ŒåŠæ—¶å‘ç°å’Œè§£å†³ç¼“å­˜ç›¸å…³çš„é—®é¢˜ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šè¿è¡Œã€‚</p>
      </div>
    </article>
    
    <!-- è¯„è®ºåŒº -->
    <div id="comments" style="max-width: 800px; margin: 3rem auto; padding: 0 1rem;">
      <div style="width: 100%; height: 1px; background: linear-gradient(to right, transparent, var(--border), transparent); margin-bottom: 2rem;"></div>
      <h3 style="margin-bottom: 1.5rem; color: var(--primary);">ğŸ’¬ è¯„è®ºåŒº</h3>
      <script src="https://giscus.app/client.js" 
           data-repo="jonny-dr/jonny-dr.github.io" 
           data-repo-id="R_kgDORKkzfg" 
           data-category="Announcements" 
           data-category-id="DIC_kwDORKkzfs4C2Wdq" 
           data-mapping="pathname" 
           data-strict="0" 
           data-reactions-enabled="1" 
           data-emit-metadata="0" 
           data-input-position="bottom" 
           data-theme="preferred_color_scheme" 
           data-lang="zh-CN" 
           crossorigin="anonymous" 
           async> 
     </script>
    </div>
  </main>

  <footer>
    <p>Â© 2026 åŒ—è¾° Â· ä¿æŒå¥½å¥‡ï¼ŒæŒç»­æˆé•¿</p>
    <p style="margin-top: 6px; font-size: 0.9rem; color: #aaa;">
      æœ¬åšå®¢é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc/4.0/" style="color: var(--primary);">CC BY-NC 4.0</a> è®¸å¯ | 
      æºç æ‰˜ç®¡äº <a href="https://github.com/" style="color: var(--primary);">GitHub</a>
    </p>
  </footer>

  <button class="back-to-top" id="backToTop" aria-label="å›åˆ°é¡¶éƒ¨">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="m18 15-6-6-6 6"/>
    </svg>
  </button>

  <script src="../../../../js/theme.js"></script>
</body>
</html>
  